{% extends 'govapp/base.html' %}

{% block content %}

{% if request.user.is_authenticated is True %}
      {% include "govapp/common_entity_modal.html" %}

      <input type="hidden" id="csrfmiddlewaretoken" name="csrfmiddlewaretoken" value="{{ csrf_token  }}">

      <div class="container" id="dashboard-table-container">
            
            <div class="card" >
                  <div class="card-header fw-bold h4" style="padding:30px;">
                        <div class="row">
                        <div class="col-6">
                              Usergroups
                        </div>
                        <div class="col-6 text-end">
                              <i class="bi fw-bold chevron-toggle down-chevron-open" data-bs-target="#box1-card-body" onclick=""></i>
                        </div>
                  </div>         
                  </div>
                  <div class="card-body collapse show" id="box1-card-body">
                        <div class="container">
                              <button id="add-box-pair-container" class="btn btn-success mb-3">Add Box Pair Container</button>
                              <div id="box-pair-containers">
                                  <!-- Box pair containers will be dynamically added here -->
                              </div>
                          </div>
                  </div>
            </div>
      </div>
      
      <style>
        .box {
            border: 1px solid #ccc;
            min-height: 200px;
            padding: 10px;
            margin: 10px;
            background-color: #f9f9f9;
            overflow-y: auto;
        }
        .item {
            padding: 5px;
            margin: 5px;
            background-color: #ddd;
            cursor: pointer;
            user-select: none;
        }
        .controls {
            text-align: center;
            margin-top: 20px;
        }
        .selected {
            background-color: #aaf;
        }
        .box-pair, .box-pair-container {
            border: 1px solid #000;
            padding: 10px;
            margin: 10px;
            position: relative;
        }
        .remove-box-pair, .remove-box-pair-container {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            color: red;
        }
        .box-pair-container {
            border: 2px solid #000;
            padding: 20px;
        }
      </style>

      <script>
        // Namespace to avoid global scope pollution
        var MoveItemsApp = (function() {
            let boxPairContainerCount = 0;
            let boxPairCount = 0;

            // Function to create a new box pair
            function createBoxPair(boxPairId) {
                const box1Id = `box1-${boxPairId}`;
                const box2Id = `box2-${boxPairId}`;
                const moveRightId = `move-right-${boxPairId}`;
                const moveLeftId = `move-left-${boxPairId}`;

                // Create HTML structure for the box pair
                return `
                    <div id="${boxPairId}" class="box-pair">
                        <span class="remove-box-pair">&times;</span>
                        <div class="row">
                            <div class="col">
                                <h3>Box 1</h3>
                                <div id="${box1Id}" class="box"></div>
                            </div>
                            <div class="col-2 controls">
                                <button id="${moveRightId}" class="btn btn-primary mb-2">&rarr;</button>
                                <button id="${moveLeftId}" class="btn btn-primary">&larr;</button>
                            </div>
                            <div class="col">
                                <h3>Box 2</h3>
                                <div id="${box2Id}" class="box"></div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Function to create a new box pair container
            function createBoxPairContainer() {
                const boxPairContainerId = `box-pair-container-${boxPairContainerCount}`;
                const boxPair1Id = `box-pair-1-${boxPairContainerCount}`;
                const boxPair2Id = `box-pair-2-${boxPairContainerCount}`;
                const removeContainerId = `remove-container-${boxPairContainerCount}`;

                // Create HTML structure for the box pair container
                const boxPairContainerHtml = `
                    <div id="${boxPairContainerId}" class="box-pair-container">
                        <span class="remove-box-pair-container" id="${removeContainerId}">&times;</span>
                        <div id="${boxPair1Id}" class="box-pair"></div>
                        <div id="${boxPair2Id}" class="box-pair"></div>
                    </div>
                `;
                $('#box-pair-containers').append(boxPairContainerHtml);

                // Create box pairs and append to the new container
                $(`#${boxPair1Id}`).html(createBoxPair(`box-pair-1-${boxPairContainerCount}`));
                $(`#${boxPair2Id}`).html(createBoxPair(`box-pair-2-${boxPairContainerCount}`));

                // Add initial items to the new box pairs
                addItemsToBox(`box1-box-pair-1-${boxPairContainerCount}`, ['Item 1', 'Item 2', 'Item 3']);
                addItemsToBox(`box2-box-pair-1-${boxPairContainerCount}`, ['Item 4', 'Item 5', 'Item 6']);
                addItemsToBox(`box1-box-pair-2-${boxPairContainerCount}`, ['Item 7', 'Item 8', 'Item 9']);
                addItemsToBox(`box2-box-pair-2-${boxPairContainerCount}`, ['Item 10', 'Item 11', 'Item 12']);

                // Attach event handlers for the new box pairs
                attachBoxPairEvents($(`#${boxPair1Id}`), `box-pair-1-${boxPairContainerCount}`);
                attachBoxPairEvents($(`#${boxPair2Id}`), `box-pair-2-${boxPairContainerCount}`);
                $(`#${removeContainerId}`).click(() => removeBoxPairContainer(boxPairContainerId));

                // Toggle selection state on item click
                $(`#${boxPairContainerId}`).on('click', '.item', function() {
                    $(this).toggleClass('selected');
                });

                // Update lists initially
                updateLists(`box1-box-pair-1-${boxPairContainerCount}`, `box2-box-pair-1-${boxPairContainerCount}`);
                updateLists(`box1-box-pair-2-${boxPairContainerCount}`, `box2-box-pair-2-${boxPairContainerCount}`);

                boxPairContainerCount++;
                boxPairCount += 2;
            }

            // Function to add items to a box
            function addItemsToBox(boxId, items) {
                items.forEach(item => {
                    $(`<div class="item">${item}</div>`).appendTo(`#${boxId}`);
                });
            }

            // Function to attach events to a box pair
            function attachBoxPairEvents($boxPair, boxPairId) {
                const moveRightId = `move-right-${boxPairId}`;
                const moveLeftId = `move-left-${boxPairId}`;
                $boxPair.find(`#${moveRightId}`).click(() => moveItems(`box1-${boxPairId}`, `box2-${boxPairId}`));
                $boxPair.find(`#${moveLeftId}`).click(() => moveItems(`box2-${boxPairId}`, `box1-${boxPairId}`));
            }

            // Function to move selected items from one box to another
            function moveItems(fromBoxId, toBoxId) {
                $(`#${fromBoxId} .selected`).each(function() {
                    $(this).removeClass('selected').appendTo(`#${toBoxId}`);
                });
                updateLists(fromBoxId, toBoxId);
            }

            // Function to remove a box pair container
            function removeBoxPairContainer(boxPairContainerId) {
                $(`#${boxPairContainerId}`).remove();
            }

            // Function to update the lists and log the current state
            function updateLists(box1Id, box2Id) {
                let box1Items = [];
                let box2Items = [];

                $(`#${box1Id} .item`).each(function() {
                    box1Items.push($(this).text());
                });

                $(`#${box2Id} .item`).each(function() {
                    box2Items.push($(this).text());
                });

                console.log(`Box 1 (${box1Id}) Items: `, box1Items);
                console.log(`Box 2 (${box2Id}) Items: `, box2Items);
            }

            // Initialization function
            function init() {
                // Add button click handler
                $('#add-box-pair-container').click(createBoxPairContainer);

                // Add initial box pair container on load
                createBoxPairContainer();
            }

            // Expose the init function to be called on document ready
            return {
                init: init
            };
        })();

        // Initialize the application when document is ready
        $(document).ready(function() {
            MoveItemsApp.init();
        });
      </script>
{% else %}
      <div class="container" id="dashboard-table-container">
            <h3>Permission Denied.  You are not authenticated.</h3>
      </div>
{% endif %}
{% endblock %}
